# Upstream API service. Adjust host/port to match deployment target.
upstream dashboard_api {
  server api:3000;
  keepalive 64;
}

server {
  listen 80;
  server_name _;

  # SSE console streams: disable buffering and extend timeouts so clients stay connected.
  location /api/v1/streams/ {
    proxy_pass http://dashboard_api;
    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;
    proxy_buffering off;
    proxy_cache off;
    proxy_read_timeout 1h;
    proxy_send_timeout 1h;
    chunked_transfer_encoding off;
  }

  # Fallback for other API routes (buffering can stay enabled).
  location /api/ {
    proxy_pass http://dashboard_api;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
  }
}
